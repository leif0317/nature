<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¥ç¶“ç³»çµ±æ¼”ç¤ºï¼šè…¦å¹¹è·¯å¾‘ä¿®æ­£ç‰ˆ</title>
    <style>
        :root {
            --primary: #2c3e50;
            --accent: #e74c3c;
            --highlight: #f39c12;
            --bg: #f8f9fa;
            --skin: #f0e0d6;
            --brain: #e6b8c7;      
            --brainstem: #9b59b6;  /* è…¦å¹¹ (ç´«è‰²åŠ æ·±) */
            --spine: #d4a5b8;      
            --nerve: #f1c40f;
        }

        body {
            font-family: 'Microsoft JhengHei', sans-serif;
            background-color: var(--bg);
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            padding: 20px;
        }

        h1 { margin: 10px 0; color: var(--primary); }
        .subtitle { color: #555; margin-bottom: 20px; font-size: 0.95rem; }

        .container {
            display: flex;
            gap: 30px;
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            max-width: 1250px;
            width: 100%;
            min-height: 900px;
        }

        /* å·¦å´é¸å–® */
        .menu {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .btn-group-title {
            font-weight: bold;
            color: #7f8c8d;
            margin-top: 15px;
            border-bottom: 2px solid #eee;
            padding-bottom: 5px;
        }

        .scenario-btn {
            padding: 12px 15px;
            border: 2px solid #eee;
            background: white;
            border-radius: 10px;
            cursor: pointer;
            transition: 0.2s;
            text-align: left;
            display: flex;
            align-items: center;
            font-size: 1rem;
        }

        .scenario-btn:hover { border-color: var(--highlight); background: #fffdf0; }
        .scenario-btn.active { 
            background: var(--primary); 
            color: white; 
            border-color: var(--primary); 
        }
        .scenario-btn span { margin-right: 12px; font-size: 1.4rem; }

        .status-box {
            margin-top: auto;
            padding: 20px;
            background: #ecf0f1;
            border-radius: 10px;
            border-left: 5px solid var(--primary);
        }
        .status-text { font-size: 1.1rem; font-weight: bold; color: var(--primary); }
        .status-desc { font-size: 0.95rem; color: #555; margin-top: 8px; line-height: 1.5; }

        /* å³å´è¦–è¦ºå€ */
        .visual-area {
            flex: 1.8;
            position: relative;
            background: #fff;
            border: 1px solid #eee;
            border-radius: 20px;
            display: flex;
            justify-content: center;
            overflow: hidden;
        }

        svg {
            height: 850px;
            width: auto;
        }

        /* SVG æ¨£å¼ */
        .body-skin { fill: var(--skin); stroke: #dcb; stroke-width: 3; opacity: 0.5; }
        .cns-brain { fill: var(--brain); stroke: #c08a9e; stroke-width: 2; }
        .cns-brainstem { fill: var(--brainstem); stroke: #8e44ad; stroke-width: 2; }
        .cns-spine { fill: var(--spine); stroke: #c08a9e; stroke-width: 2; }
        .cns-text { 
            font-size: 14px; font-weight: bold; fill: white; 
            text-anchor: middle; pointer-events: none;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
        }

        /* å™¨å®˜èˆ‡ç¥ç¶“ç·š */
        .organ-group { display: none; }
        .organ-group.visible { display: block; }
        .organ-icon { fill: white; stroke: #333; stroke-width: 2; }

        /* é»ƒè‰²ç¥ç¶“ç·š (éœæ…‹) */
        .nerve-line { 
            fill: none; 
            stroke: var(--nerve); 
            stroke-width: 5; 
            stroke-linecap: round;
            stroke-linejoin: round;
        }

        /* ç¥ç¶“æµå‹•ç‰¹æ•ˆ */
        .nerve-line.flowing {
            stroke: #f39c12;
            stroke-dasharray: 10, 8;
            animation: flowAnim 0.5s linear infinite;
        }

        @keyframes flowAnim {
            from { stroke-dashoffset: 20; }
            to { stroke-dashoffset: 2; }
        }

        /* é“å…· */
        .prop-icon { display: none; }
        .prop-icon.visible { display: block; }

        /* è¨Šè™Ÿçƒ */
        #signal-dot {
            fill: var(--accent);
            r: 9;
            opacity: 0;
            offset-rotate: auto;
            z-index: 100;
            filter: drop-shadow(0 0 3px rgba(0,0,0,0.3));
        }
        .pulse { animation: pulse 1s infinite; }
        @keyframes pulse {
            0% { r: 9; opacity: 1; }
            50% { r: 12; opacity: 0.8; }
            100% { r: 9; opacity: 1; }
        }

        /* æµ®å‹•æ¨™ç±¤ */
        #float-label {
            position: absolute;
            background: rgba(44, 62, 80, 0.95);
            color: white;
            padding: 8px 12px;
            border-radius: 5px;
            font-size: 0.9rem;
            opacity: 0;
            transition: opacity 0.3s;
            transform: translate(-50%, -170%);
            white-space: nowrap;
            pointer-events: none;
            z-index: 200;
        }
        #float-label::after {
            content: ''; position: absolute; top: 100%; left: 50%; margin-left: -5px;
            border-width: 5px; border-style: solid;
            border-color: rgba(44, 62, 80, 0.95) transparent transparent transparent;
        }

    </style>
</head>
<body>

    <h1>ğŸ§  ç¥ç¶“å‚³å°è·¯å¾‘æ¼”ç¤º (è…¦å¹¹ä¿®æ­£ç‰ˆ)</h1>
    <p class="subtitle">ä¿®æ­£ï¼šè…¦å¹¹åå°„è·¯å¾‘ç•°å¸¸ï¼Œç¢ºä¿è¨Šè™Ÿç²¾ç¢ºåœç•™åœ¨è…¦å¹¹ä¸­å¿ƒ</p>

    <div class="container">
        <div class="menu">
            <div class="btn-group-title">æ„è­˜è¡Œç‚º (å¤§è…¦çš®è³ª)</div>
            <button class="scenario-btn" onclick="runScenario('visual')">
                <span>ğŸ‘ï¸</span> çœ‹åˆ°å°ºæ‰è½ (æ‰‹æ¥)
            </button>
            <button class="scenario-btn" onclick="runScenario('auditory')">
                <span>ğŸ‘‚</span> è½åˆ°é˜è² (å¯«å­—)
            </button>

            <div class="btn-group-title">è…¦å¹¹åå°„ (é ­éƒ¨åå°„)</div>
            <button class="scenario-btn" onclick="runScenario('reflex_blink')">
                <span>ğŸ’¨</span> é¢¨å¹é€²çœ¼ç› (çœ¨çœ¼åå°„)
            </button>
            <button class="scenario-btn" onclick="runScenario('reflex_saliva')">
                <span>ğŸ—</span> èåˆ°é¦™å‘³ (æµå£æ°´åå°„)
            </button>

            <div class="btn-group-title">è„Šé«“åå°„ (å››è‚¢åå°„)</div>
            <button class="scenario-btn" onclick="runScenario('reflex_hand')">
                <span>ğŸ”¥</span> æ‰‹ç¢°ç†±é‹ (ç¸®æ‰‹åå°„)
            </button>
            <button class="scenario-btn" onclick="runScenario('reflex_foot')">
                <span>ğŸ¦¶</span> è…³è¸©åœ–é‡˜ (ç¸®è…³åå°„)
            </button>

            <div class="status-box">
                <div class="status-text" id="status-title">æº–å‚™é–‹å§‹</div>
                <div class="status-desc" id="status-desc">è«‹é¸æ“‡ã€Œçœ¨çœ¼ã€æˆ–ã€Œæµå£æ°´ã€ï¼Œè§€å¯Ÿè¨Šè™Ÿåœ¨ç´«è‰²è…¦å¹¹å€çš„ç²¾ç¢ºè·¯å¾‘ã€‚</div>
            </div>
        </div>

        <div class="visual-area" id="visual-area">
            <div id="float-label">æç¤º</div>

            <svg viewBox="0 0 500 850" xmlns="http://www.w3.org/2000/svg" id="main-svg">
                <defs>
                    <path id="path-visual" d="M 180,120 L 250,110 L 250,250 L 320,320 L 390,420" fill="none" />
                    
                    <path id="path-auditory" d="M 140,140 L 250,110 L 250,250 L 320,320 L 390,420" fill="none" />
                    
                    <path id="path-reflex-blink" d="M 180,120 L 250,215 L 190,130" fill="none" />

                    <path id="path-reflex-saliva" d="M 150,165 L 250,215 L 200,240" fill="none" />

                    <path id="path-reflex-hand" d="M 390,420 L 320,320 L 250,300 L 320,320 L 390,420" fill="none" />

                    <path id="path-reflex-foot" d="M 180,800 L 250,480 L 210,750" fill="none" />
                </defs>

                <g id="body-group">
                    <path class="body-skin" d="M 250,40 C 180,40 150,90 150,160 C 150,230 180,260 250,260 C 320,260 350,230 350,160 C 350,90 320,40 250,40 Z" />
                    <path class="body-skin" d="M 200,260 L 300,260 L 320,350 L 320,550 L 180,550 L 180,350 Z" />
                    <path class="body-skin" d="M 180,300 L 120,450 L 110,480 C 100,500 140,500 130,480 L 140,460 L 200,320" /> 
                    <path class="body-skin" d="M 320,300 L 360,380 C 350,360 380,340 400,360 C 420,380 410,420 380,410 L 340,320 Z" />
                    <path class="body-skin" d="M 210,550 L 200,750 L 170,800 L 230,750 L 240,550" /> 
                    <path class="body-skin" d="M 290,550 L 300,750 L 330,800 L 270,750 L 260,550" /> 
                </g>

                <path class="cns-brain" d="M 250,55 C 200,55 170,95 170,140 C 170,180 200,200 250,200 C 300,200 330,180 330,140 C 330,95 300,55 250,55 Z" />
                <path d="M 250,55 L 250,200" stroke="#d090a8" stroke-width="1" fill="none"/> 
                <text x="250" y="125" class="cns-text">å¤§è…¦</text>

                <path class="cns-brainstem" d="M 230,200 L 270,200 L 265,230 L 235,230 Z" />
                <text x="250" y="220" class="cns-text" style="font-size:12px;">è…¦å¹¹</text>

                <rect class="cns-spine" x="240" y="230" width="20" height="320" rx="5" />
                <text x="250" y="320" class="cns-text" style="font-size:12px;">è„Šé«“</text>

                <g id="group-visual" class="organ-group">
                    <path id="line-visual-sensory" class="nerve-line" d="M 180,120 L 250,110" />
                    <circle cx="180" cy="120" r="10" fill="white" stroke="#333" stroke-width="2"/>
                    <circle cx="180" cy="120" r="4" fill="#333"/>
                    <text x="175" y="105" font-size="12" fill="#333">çœ¼</text>
                </g>

                <g id="group-auditory" class="organ-group">
                    <path id="line-auditory-sensory" class="nerve-line" d="M 140,140 L 250,110" />
                    <path class="organ-icon" d="M 140,125 C 130,125 125,140 130,155 C 135,160 145,155 140,140" fill="#f0e0d6" />
                    <text x="130" y="120" font-size="12" fill="#333">è€³</text>
                </g>

                <g id="group-nose" class="organ-group">
                    <path class="organ-icon" d="M 150,150 L 135,165 L 150,180" fill="#f0e0d6" />
                    <text x="130" y="150" font-size="12" fill="#333">é¼»</text>
                    
                    <path id="line-saliva-sensory" class="nerve-line" d="M 150,165 L 250,215" />
                    
                    <path id="line-saliva-motor" class="nerve-line" d="M 250,215 L 200,240" />
                    
                    <circle cx="200" cy="240" r="8" fill="#e0f7fa" stroke="#333" />
                    <text x="190" y="260" font-size="10" fill="#333">å”¾è…º</text>
                </g>

                <g id="group-blink" class="organ-group">
                    <circle cx="180" cy="120" r="10" fill="white" stroke="#333" stroke-width="2"/>
                    <circle cx="180" cy="120" r="4" fill="#333"/>
                    
                    <path id="line-blink-sensory" class="nerve-line" d="M 180,120 L 250,215" />
                    <path id="line-blink-motor" class="nerve-line" d="M 250,215 L 190,130" />
                </g>

                <path id="line-motor-hand" class="nerve-line" d="M 250,250 L 320,320 L 390,420" style="opacity:0.3"/>

                <g id="group-reflex-hand" class="organ-group">
                     <path id="line-reflex-hand-sensory" class="nerve-line" d="M 390,420 L 320,320 L 250,300" />
                </g>

                <g id="group-reflex-foot" class="organ-group">
                    <path id="line-reflex-foot-sensory" class="nerve-line" d="M 180,800 L 250,480" />
                    <path id="line-reflex-foot-motor" class="nerve-line" d="M 250,480 L 210,750" />
                </g>

                <g id="prop-pan" class="prop-icon" transform="translate(400, 430)">
                    <text font-size="40">ğŸ³</text>
                </g>
                <g id="prop-tack" class="prop-icon" transform="translate(150, 820)">
                    <text font-size="35">ğŸ“Œ</text>
                </g>
                <g id="prop-wind" class="prop-icon" transform="translate(120, 110)">
                    <text font-size="35">ğŸ’¨</text>
                </g>
                <g id="prop-food" class="prop-icon" transform="translate(100, 160)">
                    <text font-size="35">ğŸ—</text>
                </g>

                <circle id="signal-dot" cx="0" cy="0" />
            </svg>
        </div>
    </div>

    <script>
        const scenarios = {
            visual: {
                title: "è¦–è¦ºåæ‡‰ (æ‰‹æ¥å°º)",
                organId: "group-visual",
                pathId: "path-visual",
                propId: null,
                waypoints: [
                    { pct: '0%', label: 'å—å™¨(çœ¼)', desc: 'çœ¼ç›æ¥æ”¶å…‰ç·šã€‚' },
                    { pct: '8%', label: 'æ„Ÿè¦ºç¥ç¶“', desc: 'å‚³å‘å¤§è…¦çš®è³ªã€‚', flowId: 'line-visual-sensory' },
                    { pct: '16%', label: 'ä¸­æ¨(å¤§è…¦)', desc: 'æ„è­˜åˆ¤æ–·ï¼šè¦æ¥ä½å°ºã€‚' },
                    { pct: '35%', label: 'è„Šé«“(å‚³å‡º)', desc: 'å‘½ä»¤ä¸‹è¡Œã€‚' },
                    { pct: '70%', label: 'é‹å‹•ç¥ç¶“', desc: 'å‚³å‘æ‰‹éƒ¨ã€‚', flowId: 'line-motor-hand' },
                    { pct: '100%', label: 'å‹•å™¨(æ‰‹)', desc: 'è‚Œè‚‰æ”¶ç¸®ã€‚' }
                ]
            },
            auditory: {
                title: "è½è¦ºåæ‡‰ (å¯«å­—)",
                organId: "group-auditory",
                pathId: "path-auditory",
                propId: null,
                waypoints: [
                    { pct: '0%', label: 'å—å™¨(è€³)', desc: 'è€³æœµæ¥æ”¶è²æ³¢ã€‚' },
                    { pct: '12%', label: 'æ„Ÿè¦ºç¥ç¶“', desc: 'å‚³å‘å¤§è…¦çš®è³ªã€‚', flowId: 'line-auditory-sensory' },
                    { pct: '24%', label: 'ä¸­æ¨(å¤§è…¦)', desc: 'æ„è­˜åˆ¤æ–·ï¼šè¦å¯«å­—ã€‚' },
                    { pct: '45%', label: 'è„Šé«“(å‚³å‡º)', desc: 'å‘½ä»¤ä¸‹è¡Œã€‚' },
                    { pct: '75%', label: 'é‹å‹•ç¥ç¶“', desc: 'å‚³å‘æ‰‹éƒ¨ã€‚', flowId: 'line-motor-hand' },
                    { pct: '100%', label: 'å‹•å™¨(æ‰‹)', desc: 'è‚Œè‚‰æ”¶ç¸®ã€‚' }
                ]
            },
            reflex_blink: {
                title: "çœ¨çœ¼åå°„",
                organId: "group-blink",
                pathId: "path-reflex-blink",
                propId: "prop-wind",
                waypoints: [
                    { pct: '0%', label: 'å—å™¨(çœ¼)', desc: 'å—åˆ°å¼·é¢¨/ç•°ç‰©åˆºæ¿€ã€‚', flowId: null },
                    // æ„Ÿè¦ºç¥ç¶“: 0% åˆ° 50%
                    { pct: '25%', label: 'æ„Ÿè¦ºç¥ç¶“', desc: 'è¨Šè™Ÿå‚³å…¥è…¦å¹¹ã€‚', flowId: 'line-blink-sensory' },
                    // è…¦å¹¹ä¸­å¿ƒ: 50% (å› ç‚ºè·¯å¾‘æ˜¯å°ç¨±çš„Vå‹)
                    { pct: '50%', label: 'ä¸­æ¨(è…¦å¹¹)', desc: 'ã€åå°„ä¸­æ¨ã€‘è…¦å¹¹(åº§æ¨™250,215)ç›´æ¥æ›å…ƒã€‚', flowId: null },
                    // é‹å‹•ç¥ç¶“: 50% åˆ° 100%
                    { pct: '75%', label: 'é‹å‹•ç¥ç¶“', desc: 'å‘½ä»¤å‚³å›çœ¼éƒ¨è‚Œè‚‰ã€‚', flowId: 'line-blink-motor' },
                    { pct: '100%', label: 'å‹•å™¨(çœ¼è‚Œ)', desc: 'çœ¼è¼ªåŒè‚Œæ”¶ç¸®ï¼Œé–‰çœ¼ã€‚', flowId: null }
                ]
            },
            reflex_saliva: {
                title: "æµå£æ°´åå°„",
                organId: "group-nose",
                pathId: "path-reflex-saliva",
                propId: "prop-food",
                waypoints: [
                    { pct: '0%', label: 'å—å™¨(é¼»)', desc: 'èåˆ°é£Ÿç‰©é¦™å‘³ã€‚', flowId: null },
                    // æ„Ÿè¦ºç¥ç¶“
                    { pct: '25%', label: 'å—…ç¥ç¶“', desc: 'å‚³å…¥è…¦å¹¹ã€‚', flowId: 'line-saliva-sensory' },
                    // è…¦å¹¹ä¸­å¿ƒ (50% ä½ç½®ï¼Œå› ç‚ºè·¯å¾‘å®šç¾©ç¶“éä¸­é–“é»)
                    { pct: '50%', label: 'ä¸­æ¨(è…¦å¹¹)', desc: 'ã€åå°„ä¸­æ¨ã€‘è…¦å¹¹(åº§æ¨™250,215)æ§åˆ¶å”¾è…ºã€‚', flowId: null },
                    // é‹å‹•ç¥ç¶“
                    { pct: '75%', label: 'é‹å‹•ç¥ç¶“', desc: 'å‘½ä»¤å‚³è‡³å”¾è…ºã€‚', flowId: 'line-saliva-motor' },
                    { pct: '100%', label: 'å‹•å™¨(å”¾è…º)', desc: 'åˆ†æ³Œå£æ°´ã€‚', flowId: null }
                ]
            },
            reflex_hand: {
                title: "ç¸®æ‰‹åå°„",
                organId: "group-reflex-hand",
                pathId: "path-reflex-hand",
                propId: "prop-pan",
                waypoints: [
                    { pct: '0%', label: 'å—å™¨(æ‰‹)', desc: 'ç¢°è§¸é«˜æº«ã€‚' },
                    { pct: '25%', label: 'æ„Ÿè¦ºç¥ç¶“', desc: 'ç—›è¦ºå¿«é€Ÿå‚³å…¥è„Šé«“ã€‚', flowId: 'line-reflex-hand-sensory' },
                    { pct: '50%', label: 'ä¸­æ¨(è„Šé«“)', desc: 'ã€åå°„ä¸­æ¨ã€‘è„Šé«“ç›´æ¥æ›å…ƒã€‚' },
                    { pct: '75%', label: 'é‹å‹•ç¥ç¶“', desc: 'å‘½ä»¤å‚³å‘è‚Œè‚‰ã€‚', flowId: 'line-motor-hand' },
                    { pct: '100%', label: 'å‹•å™¨(æ‰‹)', desc: 'ç«‹åˆ»ç¸®æ‰‹ã€‚' }
                ]
            },
            reflex_foot: {
                title: "ç¸®è…³åå°„",
                organId: "group-reflex-foot",
                pathId: "path-reflex-foot",
                propId: "prop-tack",
                waypoints: [
                    { pct: '0%', label: 'å—å™¨(è…³)', desc: 'è¸©åˆ°åœ–é‡˜ã€‚' },
                    { pct: '25%', label: 'æ„Ÿè¦ºç¥ç¶“', desc: 'å‚³å…¥è„Šé«“ã€‚', flowId: 'line-reflex-foot-sensory' },
                    { pct: '54%', label: 'ä¸­æ¨(è„Šé«“)', desc: 'ã€åå°„ä¸­æ¨ã€‘è„Šé«“è…°éƒ¨ç›´æ¥æ›å…ƒã€‚' },
                    { pct: '75%', label: 'é‹å‹•ç¥ç¶“', desc: 'å‘½ä»¤å‚³å›è…¿éƒ¨ã€‚', flowId: 'line-reflex-foot-motor' },
                    { pct: '100%', label: 'å‹•å™¨(è…³)', desc: 'ç«‹åˆ»ç¸®è…³ã€‚' }
                ]
            }
        };

        async function runScenario(key) {
            const data = scenarios[key];
            const dot = document.getElementById('signal-dot');
            const label = document.getElementById('float-label');
            const titleBox = document.getElementById('status-title');
            const descBox = document.getElementById('status-desc');

            document.querySelectorAll('.scenario-btn').forEach(b => b.classList.remove('active'));
            event.currentTarget.classList.add('active');
            
            // é‡ç½®
            document.querySelectorAll('.nerve-line').forEach(l => l.classList.remove('flowing'));
            document.getElementById('line-motor-hand').style.opacity = '0.3'; 

            document.querySelectorAll('.organ-group').forEach(g => g.classList.remove('visible'));
            if(data.organId) document.getElementById(data.organId).classList.add('visible');
            
            document.querySelectorAll('.prop-icon').forEach(p => p.classList.remove('visible'));
            if(data.propId) document.getElementById(data.propId).classList.add('visible');

            const pathEl = document.getElementById(data.pathId);
            const pathData = pathEl.getAttribute('d');
            dot.style.offsetPath = `path('${pathData}')`;
            dot.style.offsetDistance = '0%';
            dot.style.opacity = '1';
            dot.classList.add('pulse');
            label.style.opacity = 0;

            for(let i=0; i<data.waypoints.length; i++) {
                const wp = data.waypoints[i];
                
                titleBox.innerText = `[${data.title}] ${wp.label}`;
                descBox.innerText = wp.desc;

                // è™•ç†æµå‹•å‹•ç•«
                document.querySelectorAll('.nerve-line').forEach(l => l.classList.remove('flowing'));
                if (wp.flowId) {
                    const line = document.getElementById(wp.flowId);
                    if(line) {
                        line.style.opacity = '1';
                        line.classList.add('flowing');
                    }
                }

                dot.style.transition = 'offset-distance 1.2s ease-in-out';
                dot.style.offsetDistance = wp.pct;
                await wait(1200);

                updateLabelPos(dot, wp.label);
                label.style.opacity = 1;
                await wait(1000);

                if(i < data.waypoints.length - 1) label.style.opacity = 0;
            }

            titleBox.innerText = "å‚³éå®Œæˆ";
            dot.classList.remove('pulse');
            document.querySelectorAll('.nerve-line').forEach(l => l.classList.remove('flowing'));
        }

        function updateLabelPos(dot, text) {
            const label = document.getElementById('float-label');
            label.innerText = text;
            const dotRect = dot.getBoundingClientRect();
            const containerRect = document.getElementById('visual-area').getBoundingClientRect();
            label.style.left = (dotRect.left - containerRect.left) + 'px';
            label.style.top = (dotRect.top - containerRect.top) + 'px';
        }

        function wait(ms) { return new Promise(r => setTimeout(r, ms)); }
    </script>
</body>
</html>