<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EcoBalance 7.0: äººé¡éšå±¤åŠ å…¥ç‰ˆ</title>
    <style>
        :root {
            --bg-color: #f4f7f6;
            --card-bg: #ffffff;
            --energy-theme: #27ae60;
            --toxin-theme: #c0392b;
            /* å®šç¾©5å€‹éšå±¤çš„é¡è‰² */
            --lvl1: #2ecc71; /* ç¶  */
            --lvl2: #f1c40f; /* é»ƒ */
            --lvl3: #3498db; /* è— */
            --lvl4: #9b59b6; /* ç´« */
            --lvl5: #e74c3c; /* ç´… (äººé¡) */
        }

        * { box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 0;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* --- Header & Controls --- */
        header {
            background: white;
            padding: 10px 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 60px;
            z-index: 100;
        }

        .mode-switch {
            display: flex;
            background: #eee;
            border-radius: 30px;
            padding: 3px;
        }

        .mode-btn {
            padding: 8px 20px;
            border: none;
            background: transparent;
            cursor: pointer;
            border-radius: 25px;
            font-weight: bold;
            transition: all 0.3s;
        }

        .mode-btn.active { box-shadow: 0 2px 5px rgba(0,0,0,0.2); color: white; }
        .mode-btn.e-mode.active { background: var(--energy-theme); }
        .mode-btn.t-mode.active { background: var(--toxin-theme); }

        .global-settings {
            display: flex;
            gap: 20px;
            align-items: center;
            font-size: 0.9rem;
        }

        .zoom-control {
            display: flex;
            align-items: center;
            gap: 5px;
            background: #f0f0f0;
            padding: 5px 10px;
            border-radius: 8px;
        }

        /* --- Credit Badge --- */
        .credit-badge {
            position: fixed; bottom: 20px; right: 20px;
            background-color: #2c3e50; color: #fff;
            padding: 10px 25px; border-radius: 50px;
            font-weight: bold; font-size: 1.1rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            border: 3px solid white; z-index: 1000;
            pointer-events: none; display: flex; align-items: center; gap: 8px;
            animation: pulse 3s infinite;
        }
        .credit-badge::before { content: 'ğŸ¨'; font-size: 1.2rem; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }

        /* --- Stage & Scaler --- */
        #stage {
            flex: 1; display: flex; justify-content: center; align-items: center;
            position: relative; width: 100%; height: calc(100vh - 60px); overflow: hidden;
        }
        #scaler {
            width: 95%; height: 95%; display: flex; justify-content: center; align-items: center;
            transform-origin: center center; transition: transform 0.2s ease;
        }

        /* --- Common Card Styles --- */
        .level-card {
            background: var(--card-bg); border-radius: 12px; padding: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1); display: flex; position: relative;
            transition: all 0.5s ease; border: 2px solid transparent;
        }

        .icon-box {
            width: 40px; height: 40px; border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            font-size: 1.5rem; color: white; margin-right: 10px; flex-shrink: 0;
            transition: all 0.3s ease; /* æ·»åŠ éæ¸¡æ•ˆæœ */
        }
        .l1 .icon-box { background: var(--lvl1); }
        .l2 .icon-box { background: var(--lvl2); }
        .l3 .icon-box { background: var(--lvl3); }
        .l4 .icon-box { background: var(--lvl4); }
        .l5 .icon-box { background: var(--lvl5); }

        .info h3 { margin: 0; font-size: 1rem; color: #333; }
        .info p { margin: 0; font-size: 0.8rem; color: #777; }

        /* ============================
           MODE A: Energy Pyramid (5 Levels)
           Order: L5(Top) -> L1(Bottom)
        ============================ */
        .view-energy {
            display: flex; flex-direction: column; align-items: center;
            gap: 2px; width: 650px;
        }
        .view-energy .level-card {
            flex-direction: row; justify-content: space-between; align-items: center; height: 70px;
        }
        /* é‡æ–°èª¿æ•´5å±¤é‡‘å­—å¡”å¯¬åº¦ */
        .view-energy .l1 { width: 100%; }
        .view-energy .l2 { width: 85%; }
        .view-energy .l3 { width: 70%; }
        .view-energy .l4 { width: 55%; }
        .view-energy .l5 { width: 40%; }

        .energy-arrow {
            color: var(--energy-theme); font-weight: bold; font-size: 0.8rem;
            text-align: center; height: 18px; display: flex; align-items: center;
            justify-content: center; animation: floatUp 1.5s infinite ease-in-out; z-index: 0;
        }
        .loss-arrow {
            position: absolute; right: -90px; top: 50%; transform: translateY(-50%);
            width: 80px; color: #e67e22; display: flex; align-items: center;
            font-size: 0.75rem; font-weight: bold;
        }
        .loss-svg { width: 40px; height: 20px; fill: none; stroke: #e67e22; stroke-width: 2; stroke-dasharray: 3; }

        /* ============================
           MODE B: Toxin Chain (Horizontal)
           ã€ä¿®æ”¹é‡é»ã€‘æ”¾å¤§æ¯’ç´ æ¨¡å¼ä¸‹çš„ç”Ÿç‰©åœ–ç¤º
        ============================ */
        .view-toxin {
            display: flex; flex-direction: row; align-items: flex-start;
            justify-content: center; gap: 15px; width: 100%;
        }
        .view-toxin .level-card {
            flex-direction: column; width: 200px; height: 420px;
        }
        .view-toxin .card-header {
            display: flex; align-items: center; margin-bottom: 15px;
        }
        
        /* ã€ä¿®æ”¹é‡é»ã€‘åœ¨æ¯’ç´ æ¨¡å¼ä¸‹ï¼Œç‰¹åˆ¥æ”¾å¤§ icon-box */
        .view-toxin .icon-box {
            width: 70px;
            height: 70px;
            font-size: 3rem;
        }
        .view-toxin .info h3 { font-size: 1.2rem; } /* æ¨™é¡Œä¹Ÿç¨å¾®åŠ å¤§ */

        /* Diet & Controls */
        .diet-container {
            background: #f9f9f9; border: 1px dashed #ccc; border-radius: 8px;
            flex-grow: 1; margin-bottom: 10px; padding: 5px; overflow-y: auto;
            display: flex; align-content: flex-start; flex-wrap: wrap; gap: 4px;
        }
        .prey-item { font-size: 1.2rem; animation: pop 0.3s; }
        .control-area { background: #eee; padding: 8px; border-radius: 8px; }
        .control-area label { font-size: 0.8rem; display: block; }
        .control-area input { width: 100%; cursor: pointer; }
        .toxin-display {
            font-size: 1.2rem; font-weight: bold; color: var(--toxin-theme);
            text-align: right; margin-bottom: 5px;
        }

        /* General & Animations */
        @keyframes floatUp { 0%,100%{transform:translateY(0);} 50%{transform:translateY(-3px);} }
        @keyframes pop { 0%{transform:scale(0);} 100%{transform:scale(1);} }
        .hidden { display: none !important; }
        .danger { border-color: red !important; background-color: #fff5f5 !important; }

    </style>
</head>
<body>

<div class="credit-badge">å°ç²˜è£½ä½œ</div>

<header>
    <div class="mode-switch">
        <button class="mode-btn e-mode active" onclick="switchMode('energy')">ğŸ“ èƒ½é‡é‡‘å­—å¡”</button>
        <button class="mode-btn t-mode" onclick="switchMode('toxin')">â˜ ï¸ æ¯’ç´ ç´¯ç©éˆ</button>
    </div>

    <div class="global-settings">
        <div id="ctrl-energy">
            â˜€ï¸ å¤ªé™½èƒ½é‡: <input type="range" id="sunInput" min="5000" max="100000" value="50000" step="5000" oninput="updateEnergy()">
            <span id="sunVal" style="font-weight:bold; color:var(--energy-theme)">50000</span>
        </div>
        <div id="ctrl-toxin" class="hidden">
            ğŸ­ ç’°å¢ƒæ¯’ç´ : <input type="range" id="toxinInput" min="0" max="0.5" value="0.05" step="0.01" oninput="updateToxin()">
            <span id="toxinVal" style="font-weight:bold; color:var(--toxin-theme)">0.05 ppm</span>
        </div>
        <div class="zoom-control">
            ğŸ” ç¸®æ”¾: <input type="range" min="0.5" max="1.3" step="0.1" value="0.9" oninput="setScale(this.value)">
        </div>
    </div>
</header>

<div id="stage">
    <div id="scaler" style="transform: scale(0.9)">
        
        <div id="view-energy" class="view-energy">
            
            <div class="level-card l5">
                <div style="display:flex;align-items:center;">
                    <div class="icon-box">ğŸ§‘â€ğŸ¦±</div>
                    <div class="info"><h3>äººé¡</h3></div>
                </div>
                <div style="color:var(--energy-theme);font-weight:bold;" id="e-val-5">0 kcal</div>
                <div class="loss-arrow"><svg class="loss-svg"><path d="M0,10 Q20,0 40,10" /></svg> 90%</div>
            </div>
            <div class="energy-arrow">â¬† 10% å‚³é</div>

            <div class="level-card l4">
                <div style="display:flex;align-items:center;">
                    <div class="icon-box">ğŸ¦ˆ</div>
                    <div class="info"><h3>å¤§å‹é­šé¡</h3></div>
                </div>
                <div style="color:var(--energy-theme);font-weight:bold;" id="e-val-4">0 kcal</div>
                <div class="loss-arrow"><svg class="loss-svg"><path d="M0,10 Q20,0 40,10" /></svg> 90%</div>
            </div>
            <div class="energy-arrow">â¬† 10% å‚³é</div>

            <div class="level-card l3">
                <div style="display:flex;align-items:center;">
                    <div class="icon-box">ğŸŸ</div>
                    <div class="info"><h3>æ¬¡ç´šæ¶ˆè²»è€…</h3></div>
                </div>
                <div style="color:var(--energy-theme);font-weight:bold;" id="e-val-3">0 kcal</div>
                <div class="loss-arrow"><svg class="loss-svg"><path d="M0,10 Q20,0 40,10" /></svg> 90%</div>
            </div>
            <div class="energy-arrow">â¬† 10% å‚³é</div>

            <div class="level-card l2">
                <div style="display:flex;align-items:center;">
                    <div class="icon-box">ğŸ¦</div>
                    <div class="info"><h3>åˆç´šæ¶ˆè²»è€…</h3></div>
                </div>
                <div style="color:var(--energy-theme);font-weight:bold;" id="e-val-2">0 kcal</div>
                <div class="loss-arrow"><svg class="loss-svg"><path d="M0,10 Q20,0 40,10" /></svg> 90%</div>
            </div>
            <div class="energy-arrow">â¬† 10% å‚³é</div>

            <div class="level-card l1">
                <div style="display:flex;align-items:center;">
                    <div class="icon-box">ğŸŒ¿</div>
                    <div class="info"><h3>ç”Ÿç”¢è€…</h3></div>
                </div>
                <div style="color:var(--energy-theme);font-weight:bold;" id="e-val-1">0 kcal</div>
                <div class="loss-arrow"><svg class="loss-svg"><path d="M0,10 Q20,0 40,10" /></svg> 90%</div>
            </div>

        </div>

        <div id="view-toxin" class="view-toxin hidden">
            
            <div class="level-card l1">
                <div class="card-header">
                    <div class="icon-box">ğŸŒ¿</div>
                    <div class="info"><h3>ç”Ÿç”¢è€…</h3><p>å¸æ”¶ç’°å¢ƒæ¯’ç´ </p></div>
                </div>
                <div class="diet-container" style="justify-content:center; align-items:center; color:#999;">(ç›´æ¥å¸æ”¶)</div>
                <div class="toxin-display" id="t-conc-1">0.0 ppm</div>
                <div class="control-area" style="opacity:0; pointer-events: none;"><label>Placeholder</label><input type="range"></div>
            </div>

            <div class="level-card l2" id="t-card-2">
                <div class="card-header">
                    <div class="icon-box">ğŸ¦</div>
                    <div class="info"><h3>åˆç´šæ¶ˆè²»è€…</h3><p>åƒè—»é¡</p></div>
                </div>
                <div class="diet-container" id="diet-2"></div>
                <div class="toxin-display" id="t-conc-2">0.0 ppm</div>
                <div class="control-area">
                    <label>æ”é£Ÿæ•¸é‡: <span id="count-2">5</span></label>
                    <input type="range" id="eat-1" min="1" max="12" value="5" oninput="updateToxin()">
                </div>
            </div>

            <div class="level-card l3" id="t-card-3">
                <div class="card-header">
                    <div class="icon-box">ğŸŸ</div>
                    <div class="info"><h3>æ¬¡ç´šæ¶ˆè²»è€…</h3><p>åƒç£·è¦</p></div>
                </div>
                <div class="diet-container" id="diet-3"></div>
                <div class="toxin-display" id="t-conc-3">0.0 ppm</div>
                <div class="control-area">
                    <label>æ”é£Ÿæ•¸é‡: <span id="count-3">3</span></label>
                    <input type="range" id="eat-2" min="1" max="8" value="3" oninput="updateToxin()">
                </div>
            </div>

            <div class="level-card l4" id="t-card-4">
                <div class="card-header">
                    <div class="icon-box">ğŸ¦ˆ</div>
                    <div class="info"><h3>å¤§å‹é­šé¡</h3><p>åƒå°é­š</p></div>
                </div>
                <div class="diet-container" id="diet-4"></div>
                <div class="toxin-display" id="t-conc-4">0.0 ppm</div>
                <div class="control-area">
                    <label>æ”é£Ÿæ•¸é‡: <span id="count-4">2</span></label>
                    <input type="range" id="eat-3" min="1" max="5" value="2" oninput="updateToxin()">
                </div>
            </div>

            <div class="level-card l5" id="t-card-5">
                <div class="card-header">
                    <div class="icon-box">ğŸ§‘â€ğŸ¦±</div>
                    <div class="info"><h3>äººé¡</h3><p>åƒå¤§å‹é­šé¡</p></div>
                </div>
                <div class="diet-container" id="diet-5"></div>
                <div class="toxin-display" id="t-conc-5">0.0 ppm</div>
                <div class="control-area">
                    <label>æ”é£Ÿæ•¸é‡: <span id="count-5">1</span></label>
                    <input type="range" id="eat-4" min="1" max="3" value="1" oninput="updateToxin()">
                </div>
            </div>

        </div>

    </div>
</div>

<script>
    function switchMode(mode) {
        document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
        document.querySelector(`.mode-btn.${mode === 'energy' ? 'e-mode' : 't-mode'}`).classList.add('active');
        const ctrlE = document.getElementById('ctrl-energy'); const ctrlT = document.getElementById('ctrl-toxin');
        const viewE = document.getElementById('view-energy'); const viewT = document.getElementById('view-toxin');
        if (mode === 'energy') {
            viewE.classList.remove('hidden'); viewT.classList.add('hidden');
            ctrlE.classList.remove('hidden'); ctrlT.classList.add('hidden'); updateEnergy(); 
        } else {
            viewE.classList.add('hidden'); viewT.classList.remove('hidden');
            ctrlE.classList.add('hidden'); ctrlT.classList.remove('hidden'); updateToxin(); 
        }
    }
    function setScale(val) { document.getElementById('scaler').style.transform = `scale(${val})`; }

    // --- èƒ½é‡è¨ˆç®— (5å±¤) ---
    function updateEnergy() {
        const sun = parseInt(document.getElementById('sunInput').value);
        document.getElementById('sunVal').innerText = sun;
        const e1 = sun;
        const e2 = Math.round(e1 * 0.1);
        const e3 = Math.round(e2 * 0.1);
        const e4 = Math.round(e3 * 0.1);
        const e5 = Math.round(e4 * 0.1); // äººé¡èƒ½é‡

        document.getElementById('e-val-1').innerText = e1.toLocaleString() + " kcal";
        document.getElementById('e-val-2').innerText = e2.toLocaleString() + " kcal";
        document.getElementById('e-val-3').innerText = e3.toLocaleString() + " kcal";
        document.getElementById('e-val-4').innerText = e4.toLocaleString() + " kcal";
        document.getElementById('e-val-5').innerText = e5.toLocaleString() + " kcal";
    }

    // --- æ¯’ç´ è¨ˆç®— (5å±¤æ”é£Ÿæ”¾å¤§) ---
    function updateToxin() {
        const env = parseFloat(document.getElementById('toxinInput').value);
        document.getElementById('toxinVal').innerText = env.toFixed(2) + " ppm";

        const n2 = parseInt(document.getElementById('eat-1').value); 
        const n3 = parseInt(document.getElementById('eat-2').value); 
        const n4 = parseInt(document.getElementById('eat-3').value); 
        const n5 = parseInt(document.getElementById('eat-4').value); // äººé¡åƒå¤§é­šæ•¸é‡

        document.getElementById('count-2').innerText = n2;
        document.getElementById('count-3').innerText = n3;
        document.getElementById('count-4').innerText = n4;
        document.getElementById('count-5').innerText = n5;

        const c1 = env;
        const c2 = c1 * n2;
        const c3 = c2 * n3;
        const c4 = c3 * n4;
        const c5 = c4 * n5; // äººé¡æ¿ƒåº¦

        updateToxinCard('1', c1, null);
        updateToxinCard('2', c2, 't-card-2');
        updateToxinCard('3', c3, 't-card-3');
        updateToxinCard('4', c4, 't-card-4');
        updateToxinCard('5', c5, 't-card-5');

        renderDiet('diet-2', 'ğŸŒ¿', n2);
        renderDiet('diet-3', 'ğŸ¦', n3);
        renderDiet('diet-4', 'ğŸŸ', n4);
        renderDiet('diet-5', 'ğŸ¦ˆ', n5); // äººé¡èƒƒè£¡çš„é¯Šé­š
    }

    function updateToxinCard(id, val, cardId) {
        const el = document.getElementById(`t-conc-${id}`);
        el.innerText = val.toFixed(2) + " ppm";
        if (cardId) {
            const card = document.getElementById(cardId);
            // ç¨å¾®èª¿ä½è®Šè‰²é–¾å€¼ï¼Œè®“äººé¡æ›´å®¹æ˜“è®Šç´…
            if (val > 15) card.classList.add('danger'); else card.classList.remove('danger');
        }
    }

    function renderDiet(containerId, icon, count) {
        const div = document.getElementById(containerId); div.innerHTML = ''; 
        for(let i=0; i<count; i++) {
            const span = document.createElement('span'); span.className = 'prey-item';
            span.innerText = icon; span.style.animationDelay = (i * 0.05) + 's';
            div.appendChild(span);
        }
    }

    // é è¨­ç¸®æ”¾æ¯”ä¾‹ç¨å¾®èª¿å°ï¼Œä»¥é©æ‡‰5å¼µå¡ç‰‡
    setScale(0.9);
    switchMode('energy');
</script>

</body>
</html>