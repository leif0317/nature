<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>å¤ªé™½ç³»æ¨¡æ“¬ï½œå°ç²˜è£½ä½œ</title>
<style>
  html, body { margin: 0; padding: 0; background: #000; overflow: hidden; width: 100%; height: 100%; font-family: "Microsoft JhengHei", sans-serif; }
  /* èƒŒæ™¯æ˜Ÿç©º */
  body { background-image: url('https://upload.wikimedia.org/wikipedia/commons/8/89/HD.15.039.jpg'); background-size: cover; background-position: center; }
  
  /* é ‚éƒ¨æç¤ºæ–‡å­— */
  #hint {
    position: fixed; top: 15px; left: 0; width: 100%;
    text-align: center; color: #ccc; font-size: 14px; text-shadow: 0 2px 4px #000;
    pointer-events: none; z-index: 10; letter-spacing: 1px;
  }

  /* å³ä¸‹è§’ç½²å */
  #credits {
    position: fixed; bottom: 10px; right: 15px;
    color: rgba(255, 255, 255, 0.4); /* åŠé€æ˜ç™½è‰² */
    font-size: 13px; pointer-events: none; z-index: 10;
    text-shadow: 0 1px 2px rgba(0,0,0,0.8); font-weight: 300;
  }

  /* --- æ§åˆ¶é¢æ¿æ¨£å¼ --- */
  .controls {
    position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
    display: flex; gap: 12px; z-index: 20;
    background: rgba(0, 0, 0, 0.6);
    padding: 10px 20px;
    border-radius: 40px;
    border: 1px solid rgba(255,255,255,0.15);
    backdrop-filter: blur(8px);
    align-items: center; /* å‚ç›´ç½®ä¸­ */
  }
  
  .btn-group { display: flex; gap: 5px; align-items: center; }
  .divider { width: 1px; height: 24px; background: rgba(255,255,255,0.3); margin: 0 5px; }
  
  /* æŒ‰éˆ•é€šç”¨æ¨£å¼ */
  button {
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    color: #fff; padding: 8px 16px; border-radius: 20px;
    font-size: 14px; cursor: pointer; 
    transition: all 0.2s ease; outline: none;
    user-select: none; min-width: 40px;
    display: flex; align-items: center; justify-content: center;
    white-space: nowrap; /* é˜²æ­¢æ–‡å­—æ›è¡Œ */
  }
  button:hover { background: rgba(255, 255, 255, 0.25); transform: translateY(-2px); }
  button:active { transform: scale(0.95) translateY(0); }
  button.circle { border-radius: 50%; padding: 0; width: 36px; height: 36px; font-weight: bold; font-size: 18px; }
  button.active { background: rgba(74, 163, 255, 0.6); border-color: #4aa3ff; box-shadow: 0 0 10px rgba(74, 163, 255, 0.4); }
  #btn-reset:hover { background: rgba(255, 80, 80, 0.4); border-color: #ff5050; }

  /* --- æ»‘å‹•æ¡¿æ¨£å¼ (Range Slider) --- */
  .slider-container {
    display: flex; align-items: center; margin: 0 8px;
  }
  input[type=range] {
    -webkit-appearance: none; appearance: none;
    width: 70px; height: 6px;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 3px; outline: none; transition: opacity .2s;
  }
  input[type=range]::-webkit-slider-thumb {
    -webkit-appearance: none; appearance: none;
    width: 16px; height: 16px;
    background: #fff; cursor: pointer;
    border-radius: 50%; box-shadow: 0 0 5px rgba(0,0,0,0.5);
  }
  input[type=range]::-moz-range-thumb {
    width: 16px; height: 16px; background: #fff; cursor: pointer;
    border-radius: 50%; box-shadow: 0 0 5px rgba(0,0,0,0.5); border: none;
  }

  canvas { display: block; }
</style>
</head>
<body>

<div id="hint">æ­£åœ¨è¼‰å…¥è¡Œæ˜Ÿç´‹ç†... (0/8)</div>

<div id="credits">å°ç²˜è£½ä½œ</div>

<div class="controls">
  <div class="btn-group">
    <button id="btn-zoom-out" class="circle" title="ç¸®å°">ï¼</button>
    <button id="btn-zoom-in" class="circle" title="æ”¾å¤§">ï¼‹</button>
    <button id="btn-reset" title="é‚„åŸåˆå§‹ç‹€æ…‹">â†º é‡ç½®</button>
  </div>
  
  <div class="divider"></div>

  <div class="btn-group">
    <button id="btn-comet" class="active" title="é¡¯ç¤º/éš±è—å½—æ˜Ÿ">â˜„ï¸</button>
    <div class="slider-container" title="èª¿æ•´å½—æ˜Ÿå¤§å°">
      <input type="range" id="comet-size-slider" min="0.5" max="3.0" step="0.1" value="1">
    </div>
    <button id="btn-orbit" title="é–‹å§‹/æš«åœå…¬è½‰">ğŸª å…¬è½‰</button>
  </div>
</div>

<canvas id="cv"></canvas>

<script>
(function(){
  const canvas = document.getElementById('cv');
  const ctx = canvas.getContext('2d');
  const hint = document.getElementById('hint');
  
  // DOM å…ƒç´ 
  const btnComet = document.getElementById('btn-comet');
  const btnOrbit = document.getElementById('btn-orbit');
  const btnZoomIn = document.getElementById('btn-zoom-in');
  const btnZoomOut = document.getElementById('btn-zoom-out');
  const btnReset = document.getElementById('btn-reset');
  const cometSizeSlider = document.getElementById('comet-size-slider');

  let w = 0, h = 0, cx = 0, cy = 0;
  
  // --- è¦–åœ–æ§åˆ¶è®Šæ•¸ ---
  let scale = 1.0;          
  const SCALE_STEP = 0.2;   
  const MIN_SCALE = 0.4;    
  const MAX_SCALE = 2.5;    

  // --- ç‹€æ…‹æ§åˆ¶è®Šæ•¸ ---
  let isCometVisible = true;
  let isOrbiting = false; 
  let cometScale = 1.0;

  // --- è¡Œæ˜Ÿæ•¸æ“š ---
  const planetsData = [
    { name: 'æ°´æ˜Ÿ', size: 2.5, speed: 0.040, angle: 0, imgUrl: 'https://upload.wikimedia.org/wikipedia/commons/thumb/3/30/Mercury_in_color_-_Prockter07_centered.jpg/600px-Mercury_in_color_-_Prockter07_centered.jpg' },
    { name: 'é‡‘æ˜Ÿ', size: 4.0, speed: 0.025, angle: 0, imgUrl: 'https://upload.wikimedia.org/wikipedia/commons/thumb/0/08/Venus_from_Mariner_10.jpg/600px-Venus_from_Mariner_10.jpg' },
    { name: 'åœ°çƒ', size: 4.2, speed: 0.020, angle: 0, imgUrl: 'https://upload.wikimedia.org/wikipedia/commons/thumb/9/97/The_Earth_seen_from_Apollo_17.jpg/600px-The_Earth_seen_from_Apollo_17.jpg' },
    { name: 'ç«æ˜Ÿ', size: 3.0, speed: 0.016, angle: 0, imgUrl: 'https://upload.wikimedia.org/wikipedia/commons/thumb/0/02/OSIRIS_Mars_true_color.jpg/600px-OSIRIS_Mars_true_color.jpg' },
    { name: 'æœ¨æ˜Ÿ', size: 10.0, speed: 0.008, angle: 0, imgUrl: 'https://upload.wikimedia.org/wikipedia/commons/thumb/2/2b/Jupiter_and_its_shrunken_Great_Red_Spot.jpg/600px-Jupiter_and_its_shrunken_Great_Red_Spot.jpg' },
    { name: 'åœŸæ˜Ÿ', size: 8.5, speed: 0.006, angle: 0, imgUrl: 'https://upload.wikimedia.org/wikipedia/commons/thumb/c/c7/Saturn_during_Equinox.jpg/600px-Saturn_during_Equinox.jpg' },
    { name: 'å¤©ç‹æ˜Ÿ', size: 6.0, speed: 0.004, angle: 0, imgUrl: 'https://upload.wikimedia.org/wikipedia/commons/thumb/3/3d/Uranus2.jpg/600px-Uranus2.jpg' },
    { name: 'æµ·ç‹æ˜Ÿ', size: 5.8, speed: 0.003, angle: 0, imgUrl: 'https://upload.wikimedia.org/wikipedia/commons/thumb/6/63/Neptune_-_Voyager_2_%2829347980845%29_flatten_crop.jpg/600px-Neptune_-_Voyager_2_%2829347980845%29_flatten_crop.jpg' }
  ];

  // --- å°è¡Œæ˜Ÿå¸¶æ•¸æ“š ---
  const asteroids = [];
  const ASTEROID_COUNT = 800;
  let asteroidAngleOffset = 0; 
  initAsteroids();

  // --- å½—æ˜Ÿè»Œé“åƒæ•¸ ---
  const startTheta = Math.PI * 1.8; 
  const endTheta = Math.PI * 0.2;   
  let theta = startTheta; 
  const e = 0.88; 

  function initAsteroids() {
    asteroids.length = 0;
    for(let i=0; i<ASTEROID_COUNT; i++) {
      asteroids.push({
        angle: Math.random() * Math.PI * 2,
        rFactor: Math.random(), 
        size: Math.random() * 1.5 + 0.5, 
        opacity: Math.random() * 0.5 + 0.3
      });
    }
  }

  // --- åœ–ç‰‡é è¼‰å…¥ ---
  let loadedCount = 0;
  let imagesLoaded = false;

  function preloadImages() {
    planetsData.forEach((p) => {
      const img = new Image();
      img.crossOrigin = "Anonymous"; 
      img.onload = () => {
        p.imageElement = img;
        loadedCount++;
        hint.innerText = `æ­£åœ¨è¼‰å…¥è¡Œæ˜Ÿç´‹ç†... (${loadedCount}/${planetsData.length})`;
        if (loadedCount === planetsData.length) {
          imagesLoaded = true;
          hint.innerText = "";
          requestAnimationFrame(draw);
        }
      };
      img.onerror = () => { loadedCount++; if (loadedCount === planetsData.length) { imagesLoaded = true; requestAnimationFrame(draw); }};
      img.src = p.imgUrl;
    });
  }

  // --- äº‹ä»¶ç¶å®š ---
  
  btnZoomIn.addEventListener('click', () => {
    scale = Math.min(scale + SCALE_STEP, MAX_SCALE);
  });
  
  btnZoomOut.addEventListener('click', () => {
    scale = Math.max(scale - SCALE_STEP, MIN_SCALE);
  });

  // æ»‘æ¡¿äº‹ä»¶
  cometSizeSlider.addEventListener('input', (e) => {
    cometScale = parseFloat(e.target.value);
  });

  btnReset.addEventListener('click', () => {
    scale = 1.0;
    theta = startTheta;
    planetsData.forEach(p => p.angle = 0);
    asteroidAngleOffset = 0;
    isOrbiting = false;
    btnOrbit.classList.remove('active');
    isCometVisible = true;
    btnComet.classList.add('active');
    // é‡ç½®æ»‘æ¡¿
    cometScale = 1.0;
    cometSizeSlider.value = "1";
  });

  btnComet.addEventListener('click', () => {
    isCometVisible = !isCometVisible;
    btnComet.classList.toggle('active', isCometVisible);
  });

  btnOrbit.addEventListener('click', () => {
    isOrbiting = !isOrbiting;
    btnOrbit.classList.toggle('active', isOrbiting);
  });


  function resize() {
    const dpr = window.devicePixelRatio || 1;
    w = window.innerWidth;
    h = window.innerHeight;
    cx = w / 2;
    cy = h / 2;
    canvas.width = w * dpr;
    canvas.height = h * dpr;
    canvas.style.width = w + 'px';
    canvas.style.height = h + 'px';
    ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
  }

  function draw() {
    if (!imagesLoaded || w === 0 || h === 0) { 
      if (imagesLoaded) requestAnimationFrame(draw);
      return; 
    }

    ctx.clearRect(0, 0, w, h);

    // ç¸®æ”¾çŸ©é™£
    ctx.save();
    ctx.translate(cx, cy);
    ctx.scale(scale, scale);
    ctx.translate(-cx, -cy);

    const sunRadius = 45;
    const maxRadius = Math.min(w, h) / 2;
    const gap = Math.max(35, (maxRadius - sunRadius - 20) / planetsData.length);

    // ç•«å¤ªé™½
    const g = ctx.createRadialGradient(cx, cy, 10, cx, cy, sunRadius + 5);
    g.addColorStop(0, 'rgba(255, 240, 150, 1)');
    g.addColorStop(0.2, 'rgba(255, 200, 50, 0.9)');
    g.addColorStop(1, 'rgba(255, 100, 0, 0)');
    ctx.fillStyle = g;
    ctx.beginPath();
    ctx.arc(cx, cy, sunRadius + 5, 0, Math.PI * 2);
    ctx.fill();
    ctx.fillStyle = '#fffab0';
    ctx.beginPath();
    ctx.arc(cx, cy, 8, 0, Math.PI * 2);
    ctx.fill();

    // ç•«è»Œé“ç·š & è¡Œæ˜Ÿ
    for (let i = 0; i < planetsData.length; i++) {
      const p = planetsData[i];
      const orbitR = sunRadius + 20 + (i * gap);

      // ç•«è»Œé“ç·š
      ctx.strokeStyle = 'rgba(255,255,255,0.08)';
      ctx.lineWidth = 1 / scale; 
      ctx.beginPath();
      ctx.arc(cx, cy, orbitR, 0, Math.PI * 2);
      ctx.stroke();

      // --- å°è¡Œæ˜Ÿå¸¶ ---
      if (i === 3) {
        const rStart = orbitR + gap * 0.3;
        const rEnd = orbitR + gap * 0.7;
        const beltWidth = rEnd - rStart;

        ctx.fillStyle = '#888';
        for (let a of asteroids) {
          const currentA = a.angle + asteroidAngleOffset;
          const r = rStart + a.rFactor * beltWidth;
          const ax = cx + r * Math.cos(currentA);
          const ay = cy + r * Math.sin(currentA);

          ctx.globalAlpha = a.opacity;
          ctx.beginPath();
          ctx.arc(ax, ay, a.size, 0, Math.PI*2);
          ctx.fill();
        }
        ctx.globalAlpha = 1.0;
      }

      // --- ç¹ªè£½è¡Œæ˜Ÿ ---
      const planetX = cx + orbitR * Math.cos(p.angle);
      const planetY = cy + orbitR * Math.sin(p.angle);

      if (p.imageElement) {
        ctx.save();
        ctx.beginPath();
        ctx.arc(planetX, planetY, p.size, 0, Math.PI * 2);
        ctx.closePath();
        ctx.clip(); 
        ctx.drawImage(p.imageElement, planetX - p.size, planetY - p.size, p.size * 2, p.size * 2);
        ctx.restore(); 
        
        const shadowAngle = Math.atan2(planetY - cy, planetX - cx);
        ctx.fillStyle = 'rgba(0,0,0,0.5)';
        ctx.beginPath();
        ctx.arc(planetX, planetY, p.size, shadowAngle + Math.PI/2, shadowAngle - Math.PI/2);
        ctx.fill();
      }

      if (isOrbiting) p.angle -= p.speed;
    }

    if (isOrbiting) asteroidAngleOffset -= 0.002;

    // ç•«å½—æ˜Ÿ (é€†æ™‚é‡: 1.8PI -> 0.2PI)
    if (isCometVisible) {
      const perihelionDist = sunRadius + 15;
      const a = perihelionDist / (1 - e);
      const r_comet = (a * (1 - e * e)) / (1 - e * Math.cos(theta)); 
      
      const x = cx + r_comet * Math.cos(theta);
      const y = cy + r_comet * Math.sin(theta);
      
      const dx = x - cx;
      const dy = y - cy;
      const safeDist = Math.max(Math.sqrt(dx*dx + dy*dy), 1);

      // --- å½—æ˜Ÿå¤§å°åƒæ•¸ ---
      const baseTailWidth = 2.5;
      const baseNucleusSize = 2.5;
      
      // å°¾å·´é•·åº¦ï¼šåŸºç¤é•·åº¦è¨ˆç®—å¾Œï¼Œä¹˜ä¸Š cometScale (ç­‰æ¯”ä¾‹æ”¾å¤§)
      const baseTailLen = Math.min(60, 1200 / safeDist);
      const tailLen = baseTailLen * cometScale; 

      const tx = x + (dx / safeDist) * tailLen;
      const ty = y + (dy / safeDist) * tailLen;
      const grad = ctx.createLinearGradient(x, y, tx, ty);
      grad.addColorStop(0, 'rgba(200, 230, 255, 0.9)');
      grad.addColorStop(1, 'rgba(200, 230, 255, 0)');
      
      ctx.strokeStyle = grad;
      // å°¾å·´å¯¬åº¦ï¼šä¹˜ä¸Š cometScale (ç­‰æ¯”ä¾‹æ”¾å¤§)
      ctx.lineWidth = (baseTailWidth * cometScale) / scale; 
      
      ctx.lineCap = 'round';
      ctx.beginPath();
      ctx.moveTo(x, y);
      ctx.lineTo(tx, ty);
      ctx.stroke();

      // å½—æ ¸ï¼šä¹˜ä¸Š cometScale
      ctx.fillStyle = '#fff';
      ctx.beginPath();
      ctx.arc(x, y, baseNucleusSize * cometScale, 0, Math.PI * 2);
      ctx.fill();

      let speed = 0.004 * (a / safeDist);
      theta -= speed; 
      if (theta < endTheta) theta = startTheta;
    }

    ctx.restore();
    requestAnimationFrame(draw);
  }

  window.addEventListener('resize', resize);
  resize();
  preloadImages();

})();
</script>
</body>
</html>